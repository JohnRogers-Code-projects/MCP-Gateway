{
  "permissions": {
    "allow": [
      "Bash(pip install:*)",
      "Bash(python -m uvicorn:*)",
      "Bash(python -m pytest:*)",
      "Bash(cat:*)",
      "Bash(python -c \"\ncontent = ''''''\"\"\"\"\"\"\nDashboard Routes\n\nProvides the demo dashboard UI and supporting endpoints:\n- Static file serving (CSS, JS)\n- HTML template rendering\n- WebSocket endpoint for streaming test output\n\nKept separate from server.py to isolate demo UI from core MCP logic.\nIn production, you''d likely disable this entirely or put it behind auth.\n\"\"\"\"\"\"\n\nimport asyncio\nimport os\nimport sys\nfrom pathlib import Path\n\nfrom fastapi import APIRouter, WebSocket, WebSocketDisconnect\nfrom fastapi.responses import HTMLResponse\nfrom fastapi.staticfiles import StaticFiles\nfrom fastapi.templating import Jinja2Templates\nfrom starlette.requests import Request\n\n# Paths relative to this file\nBASE_DIR = Path(__file__).parent\nSTATIC_DIR = BASE_DIR / \"\"static\"\"\nTEMPLATES_DIR = BASE_DIR / \"\"templates\"\"\n\n# Router for dashboard endpoints\nrouter = APIRouter()\n\n# Jinja2 templates\ntemplates = Jinja2Templates(directory=str(TEMPLATES_DIR))\n\n\n@router.get(\"\"/\"\", response_class=HTMLResponse)\nasync def dashboard(request: Request) -> HTMLResponse:\n    \"\"\"\"\"\"Serve the main dashboard page.\"\"\"\"\"\"\n    return templates.TemplateResponse(\"\"dashboard.html\"\", {\"\"request\"\": request})\n\n\n@router.websocket(\"\"/ws/tests\"\")\nasync def websocket_test_runner(websocket: WebSocket) -> None:\n    \"\"\"\"\"\"\n    WebSocket endpoint for streaming test output.\n\n    Runs pytest and streams stdout/stderr line by line to the client.\n    This gives real-time feedback rather than blocking until tests complete.\n\n    Security note: In production, this would need authentication.\n    Running arbitrary subprocess commands is dangerous - here we only run pytest.\n    \"\"\"\"\"\"\n    await websocket.accept()\n\n    # Find the python directory (where tests live)\n    python_dir = BASE_DIR.parent\n\n    try:\n        await websocket.send_text(f\"\"Starting pytest in: {python_dir}\"\")\n        await websocket.send_text(f\"\"Python executable: {sys.executable}\"\")\n\n        # Run pytest with unbuffered output for real-time streaming\n        # -v for verbose, --tb=short for concise tracebacks\n        # Set PYTHONUNBUFFERED for proper streaming on Windows\n        env = {**os.environ, \"\"PYTHONUNBUFFERED\"\": \"\"1\"\"}\n        process = await asyncio.create_subprocess_exec(\n            sys.executable, \"\"-m\"\", \"\"pytest\"\",\n            \"\"-v\"\", \"\"--tb=short\"\", \"\"-x\"\",  # -x stops on first failure for faster feedback\n            cwd=str(python_dir),\n            stdout=asyncio.subprocess.PIPE,\n            stderr=asyncio.subprocess.STDOUT,  # Merge stderr into stdout\n            env=env,\n        )\n\n        await websocket.send_text(f\"\"Process started with PID: {process.pid}\"\")\n\n        # Stream output line by line\n        while True:\n            if process.stdout is None:\n                await websocket.send_text(\"\"ERROR: stdout is None\"\")\n                break\n\n            line = await process.stdout.readline()\n            if not line:\n                break\n\n            try:\n                await websocket.send_text(line.decode(\"\"utf-8\"\", errors=\"\"replace\"\").rstrip())\n            except WebSocketDisconnect:\n                process.kill()\n                return\n\n        # Wait for process to complete\n        await process.wait()\n\n        # Send summary\n        exit_code = process.returncode\n        if exit_code == 0:\n            await websocket.send_text(\"\"\\n✓ All tests passed!\"\")\n        else:\n            await websocket.send_text(f\"\"\\n✗ Tests failed (exit code {exit_code})\"\")\n\n    except Exception as e:\n        await websocket.send_text(f\"\"Error running tests: {e}\"\")\n    finally:\n        await websocket.close()\n\n\ndef get_static_files() -> StaticFiles:\n    \"\"\"\"\"\"Return StaticFiles instance for mounting.\"\"\"\"\"\"\n    return StaticFiles(directory=str(STATIC_DIR))\n''''''\n\nwith open(''C:/Users/roger/Documents/GitHub/MCP-Demo/MCP-Demo/mcp-demo/python/rest_to_mcp/dashboard.py'', ''w'', encoding=''utf-8'') as f:\n    f.write(content)\nprint(''File written successfully'')\n\")",
      "Bash(git checkout:*)",
      "Bash(python:*)",
      "Bash(tree:*)",
      "Bash(maturin develop:*)",
      "Bash(python -m maturin develop:*)",
      "Bash(where:*)",
      "Bash(curl:*)",
      "Bash(rustc:*)",
      "Bash(cmd /c \"C:\\Users\\roger\\.cargo\\bin\\rustc.exe --version\")",
      "Bash(cargo --version:*)",
      "Bash($env:USERPROFILE.cargobinrustc.exe --version)",
      "Bash(cmd /c \"C:\\Users\\roger\\.cargo\\bin\\rustc.exe --version && C:\\Users\\roger\\.cargo\\bin\\cargo.exe --version\")",
      "Bash(/c/Users/roger/.cargo/bin/rustc.exe:*)",
      "Bash(/c/Users/roger/.cargo/bin/cargo.exe --version)",
      "Bash(pip show:*)",
      "Bash(PATH=\"/c/Users/roger/.cargo/bin:$PATH\" python -m maturin:*)",
      "Bash(python -m venv:*)",
      "Bash(. .venv/Scripts/activate)",
      "Bash(pytest:*)",
      "Bash(netstat:*)",
      "Bash(taskkill //F //PID 13176)",
      "Bash(taskkill //F //PID 2936)",
      "Bash(taskkill //F //PID 27460)",
      "Bash(PATH=\"/c/Users/roger/.cargo/bin:$PATH\" cargo test:*)",
      "Bash(PATH=\"/c/Users/roger/.cargo/bin:$PATH\" PYO3_USE_ABI3_FORWARD_COMPATIBILITY=1 cargo test:*)",
      "Bash(taskkill:*)",
      "Bash(.venvScriptspython.exe:*)",
      "Bash(.venv/Scripts/activate)",
      "Bash(uvicorn:*)",
      "Bash(wc:*)",
      "Bash(tasklist:*)",
      "Bash(findstr:*)",
      "Bash(\"C:/Users/roger/Documents/GitHub/MCP-Demo/MCP-Demo/mcp-demo/python/.venv/Scripts/python.exe\" -m uvicorn:*)",
      "Bash(git add:*)",
      "Bash(git commit:*)",
      "Bash(git push:*)",
      "Bash(gh pr create:*)",
      "Bash(gh pr view:*)",
      "Bash(gh api:*)"
    ],
    "deny": [],
    "ask": []
  }
}
